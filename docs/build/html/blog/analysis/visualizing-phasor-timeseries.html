
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Visualizing Phasor Timeseries with matplotlib &#8212; NI4AI Blog 0.1 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="shortcut icon" href="../../_static/tree.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Power Factor Analysis" href="power-factor.html" />
    <link rel="prev" title="What is a Phasor?" href="whats-in-a-phasor.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="../../_static/_static/tree.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/PingThings_logo_color.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../home/index.html">
  Blog Home
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Posts
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../workshops/index.html">
  Workshops
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Tutorials
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://btrdb.readthedocs.io/en/latest/">API Docs<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://github.com/PingThingsIO/ni4ai-notebooks/tree/main/tutorials">Tutorials<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://www.pingthings.io/">PingThings<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PingThingsIO/ni4ai-notebooks" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.pingthings.io/" rel="noopener" target="_blank" title="PingThings">
            <span><i class="fa"></i></span>
            <label class="sr-only">PingThings</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Read the blog
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../data/index.html">
   Data
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/events.html">
     Wide Area Events
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../data/monitoring.html">
     Monitoring
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="index.html">
   Analytics
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="spectral-analysis.html">
     Spectral Analysis (part 1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="disaggregation.html">
     Solar Disaggregation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="angle-differencing.html">
     Angle Differencing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tap-change.html">
     Counting tap changer operations
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="voltage-sags.html">
     Voltage Sag Safari
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="benchmarking-results.html">
     Benchmarking Results
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="symmetrical-components.html">
     Symmetrical Components
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="what-is-the-angle-1.html">
     What’s the Angle? (Part 1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="what-is-the-angle-2.html">
     What’s the Angle? (Part 2)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="whats-in-a-phasor.html">
     What is a Phasor?
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Visualizing Phasor Timeseries with matplotlib
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="power-factor.html">
     Power Factor Analysis
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="linear-models-overview.html">
     Training Linear Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="blue-cut-fire.html">
     Blue Cut Fire
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="btrdb-queries-pt1.html">
     Memory Efficient Queries (Part 1)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="btrdb-queries-pt2.html">
     Memory Efficient Queries (Part 2)
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../thoughts/index.html">
   Commentary
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../thoughts/fire-season.html">
     Fire season is just around the corner
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../thoughts/pmu-siting-2.html">
     Choosing where to site distribution PMUs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../thoughts/sunshine-data.html">
     A brief walkthrough of the Sunshine uPMU dataset
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../thoughts/btrdb-explained.html">
     BTrDB Explained
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../thoughts/ekg-data.html">
     On EKG Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../ni4ai/index.html">
   Get Involved in NI4AI
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/demo-1.html">
     Demo (Part 2): Exploring Data in “The Plotter”
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/demo-2.html">
     Demo (Part 2): Establishing an API Connection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/add-sensors.html">
     Stream Data to NI4AI
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/language-bindings-survey.html">
     Language Bindings
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/democratizing-data.html">
     Democratizing Grid Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../ni4ai/expertise-for-experts.html">
     Expertise for Experts
    </a>
   </li>
  </ul>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stream-selection">
   Stream Selection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#polar-plots">
   Polar Plots
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plotting-complex-numbers">
   Plotting Complex Numbers
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#conclusion">
   Conclusion
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="visualizing-phasor-timeseries-with-matplotlib">
<h1>Visualizing Phasor Timeseries with matplotlib<a class="headerlink" href="#visualizing-phasor-timeseries-with-matplotlib" title="Permalink to this headline">¶</a></h1>
<blockquote>
<div><p>Author: Ben Bengfort</p>
<p>Date: April 25, 2020</p>
<p>This blog post demonstrates methods for visualizing phasor data as 1-D time series and a vector evolving in the polar domain.</p>
</div></blockquote>
<hr class="docutils" />
<p><img alt="Gallery" src="../../_images/gallery.png" /></p>
<p>A <em>phasor</em> is a complex number that represents a sinusoidal function by decomposing points in the sine wave into the product of a complex constant (the phasor) and a factor that encapsulates frequency. Phasors are often used in power and electrical engineering because electricity generation involves rotating copper windings which creates a sine waveform that can be measured in electricity transmission. Moreover, multi-phase power creates multiple sine waves with the same frequency, but different amplitudes and phases. As a result, power engineering computations can be transformed into algebraic equations rather than a system of differential equations by dropping the shared frequency factor.</p>
<p>Phasors are often described by their polar coordinates, the magnitude and an angle of the vector from the origin to the point in the sine wave. Phasor measurement units (PMUs) sample the phasor of electrical transmission at a constant rate (usually between 30Hz and 240Hz) creating two time series streams for the magnitude and angle per observation. PMUs that measure three phase power create these two streams for both voltage and current samples across all three phases, generating 12 total time series streams. Synchrophasors are time-synchronized PMUs that ensure the sampling across different busses (e.g. at two ends of a line) happen at the same time, usually via GPS timestamps.</p>
<p>The analytics challenge for handling this data is that modeling is not necessarily made simpler in the complex form, particularly as multiple independent series of data ends up being represented multi-dimensionally in a data frame. This post tackles one of those challenges: how do we effectively visualize timeseries of phasors in order to better understand the domain we’re working in and create intuitive visual analytics?</p>
<section id="stream-selection">
<h2>Stream Selection<a class="headerlink" href="#stream-selection" title="Permalink to this headline">¶</a></h2>
<p>In this post we will work with the <span class="xref myst">sunshine dataset</span>, focusing on a minutes worth of data from the phase 1 current of PMU1:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">matplotlib</span> <span class="n">notebook</span>

<span class="kn">import</span> <span class="nn">btrdb</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">btrdb.utils.timez</span> <span class="kn">import</span> <span class="n">ns_delta</span><span class="p">,</span> <span class="n">ns_to_datetime</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">btrdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;api.ni4ai.org:4411&quot;</span><span class="p">,</span> <span class="n">apikey</span><span class="o">=</span><span class="s2">&quot;[YOURAPIKEYHERE]&quot;</span><span class="p">)</span>

<span class="c1"># Query Range</span>
<span class="n">START</span> <span class="o">=</span> <span class="s2">&quot;2016-09-20 17:26:47.020667Z&quot;</span>
<span class="n">END</span> <span class="o">=</span> <span class="s2">&quot;2016-09-20 17:27:47.687080Z&quot;</span>

<span class="c1"># Current Phasor</span>
<span class="n">C1ANG</span> <span class="o">=</span> <span class="s2">&quot;d625793b-721f-46e2-8b8c-18f882366eeb&quot;</span>
<span class="n">C1MAG</span> <span class="o">=</span> <span class="s2">&quot;1187af71-2d54-49d4-9027-bae5d23c4bda&quot;</span>

<span class="c1"># View dataset</span>
<span class="n">streams</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">streams</span><span class="p">(</span><span class="n">C1MAG</span><span class="p">,</span> <span class="n">C1ANG</span><span class="p">)</span>
<span class="n">streams</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">END</span><span class="p">)</span><span class="o">.</span><span class="n">to_dataframe</span><span class="p">()</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:right head"><p>time</p></th>
<th class="text-align:right head"><p>sunshine/PMU1/C1MAG</p></th>
<th class="text-align:right head"><p>sunshine/PMU1/C1ANG</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:right"><p>1474392407024999999</p></td>
<td class="text-align:right"><p>117.84</p></td>
<td class="text-align:right"><p>212.306</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>1474392407033333332</p></td>
<td class="text-align:right"><p>117.865</p></td>
<td class="text-align:right"><p>212.437</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>1474392407041666665</p></td>
<td class="text-align:right"><p>117.812</p></td>
<td class="text-align:right"><p>212.549</p></td>
</tr>
<tr class="row-odd"><td class="text-align:right"><p>1474392407049999998</p></td>
<td class="text-align:right"><p>117.816</p></td>
<td class="text-align:right"><p>212.574</p></td>
</tr>
<tr class="row-even"><td class="text-align:right"><p>1474392407058333331</p></td>
<td class="text-align:right"><p>117.874</p></td>
<td class="text-align:right"><p>212.558</p></td>
</tr>
</tbody>
</table>
<p>We’re going to do a bit of data wrangling to get this data frame into a form that will be simpler to use, parsing the timestamps and renaming the columns to “amps” and “deg” so that it will be easier to access our phasor components. We will therefore directly query the database and create our own data frame rather than relying on the stream set:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_phasor_timeseries</span><span class="p">(</span><span class="n">mag_uuid</span><span class="p">,</span> <span class="n">ang_uuid</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">START</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">END</span><span class="p">):</span>
    <span class="n">mag</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">stream_from_uuid</span><span class="p">(</span><span class="n">mag_uuid</span><span class="p">)</span>
    <span class="n">ang</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">stream_from_uuid</span><span class="p">(</span><span class="n">ang_uuid</span><span class="p">)</span>

    <span class="c1"># Create time series</span>
    <span class="n">series</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">stream</span> <span class="ow">in</span> <span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">ang</span><span class="p">):</span>
        <span class="n">points</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">stream</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">))</span>
        <span class="n">times</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
            <span class="n">times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">datetime64</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">time</span><span class="p">,</span> <span class="s2">&quot;ns&quot;</span><span class="p">))</span>
            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

        <span class="n">units</span> <span class="o">=</span> <span class="n">stream</span><span class="o">.</span><span class="n">tags</span><span class="p">()[</span><span class="s2">&quot;unit&quot;</span><span class="p">]</span>
        <span class="n">series</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">units</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>


<span class="n">df</span> <span class="o">=</span> <span class="n">get_phasor_timeseries</span><span class="p">(</span><span class="n">C1MAG</span><span class="p">,</span> <span class="n">C1ANG</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="text-align:left head"><p></p></th>
<th class="text-align:right head"><p>amps</p></th>
<th class="text-align:right head"><p>deg</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-align:left"><p>2016-09-20 17:26:47.024999999</p></td>
<td class="text-align:right"><p>117.84</p></td>
<td class="text-align:right"><p>212.306</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>2016-09-20 17:26:47.033333332</p></td>
<td class="text-align:right"><p>117.865</p></td>
<td class="text-align:right"><p>212.437</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>2016-09-20 17:26:47.041666665</p></td>
<td class="text-align:right"><p>117.812</p></td>
<td class="text-align:right"><p>212.549</p></td>
</tr>
<tr class="row-odd"><td class="text-align:left"><p>2016-09-20 17:26:47.049999998</p></td>
<td class="text-align:right"><p>117.816</p></td>
<td class="text-align:right"><p>212.574</p></td>
</tr>
<tr class="row-even"><td class="text-align:left"><p>2016-09-20 17:26:47.058333331</p></td>
<td class="text-align:right"><p>117.874</p></td>
<td class="text-align:right"><p>212.558</p></td>
</tr>
</tbody>
</table>
</section>
<section id="polar-plots">
<h2>Polar Plots<a class="headerlink" href="#polar-plots" title="Permalink to this headline">¶</a></h2>
<p>Our first step will be to directly visualize our magnitudes and angles using the matplotlib polar plot, which takes an array <code class="docutils literal notranslate"><span class="pre">theta</span></code>, our angles (in either degrees or radians) and an array <code class="docutils literal notranslate"><span class="pre">r</span></code>, our magnitudes. The challenge is representing time in a 2-dimensional plot, since time is essentially our third dimension. There are multiple ways to accomplish this using line thicknesses, directional arrows, etc. In this case, I’ve chosen to use color to represent time, where lighter yellow colors represent older points and darker blue points represent new points. The code to produce the plot is as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_polar</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">ang</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;polar&#39;</span><span class="p">)</span>

    <span class="c1"># Plot color by time</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">mag</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;cividis_r&#39;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ang</span><span class="p">,</span> <span class="n">mag</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="n">mag</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mag</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">mag</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">plot_polar</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;amps&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;deg&quot;</span><span class="p">])</span>
</pre></div>
</div>
<p><img alt="Polar Plot" src="../../_images/polar_plot.png" /></p>
<p>The polar plot directly draws the points from the sine wave where the angle determines the position of the point around the circle, and the magnitude represents the distance of the point from the origin. The points travel in circles that represent the sine wave and the variability in the distance from the origin shows us the variability of the current over time. This plot can also be used to show the offset between different phases and detect if there are phase shifts that could indicate equipment problems.</p>
</section>
<section id="plotting-complex-numbers">
<h2>Plotting Complex Numbers<a class="headerlink" href="#plotting-complex-numbers" title="Permalink to this headline">¶</a></h2>
<p>The polar plot allows us to directly visualize our PMU data, but the plot is cluttered since it will always only draw circles. To detect variations or changes of interest, or to compare multiple streams, it is useful to visualize the phasors in their rectangular, rather than polar form.</p>
<p>To do this, we first need to convert the PMU data to their complex representation:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">to_complex</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">ang</span><span class="p">,</span> <span class="n">is_degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">is_degrees</span><span class="p">:</span>
        <span class="n">ang</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="n">mag</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s2">&quot;complex phasor&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">i</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">mag</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">)</span>


<span class="n">phasor</span> <span class="o">=</span> <span class="n">to_complex</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;amps&quot;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;deg&quot;</span><span class="p">],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Phase A Current Phasor&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>This function takes two <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code>, the first for the magnitudes and the second for the angles. It also two takes optional arguments - if <code class="docutils literal notranslate"><span class="pre">is_degrees</span></code> is true, the angles will be converted from degrees to radians and the name can be used to specify the name of the output series, which is useful for visualizations later. The function computes the real component of the complex vector <code class="docutils literal notranslate"><span class="pre">r</span></code> as the product of the magnitude and the cosine of the angle and the imaginary component <code class="docutils literal notranslate"><span class="pre">i</span></code> as the product of the magnitude and the sine of the angle. It then constructs a new <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code> whose dtype is <code class="docutils literal notranslate"><span class="pre">np.complex128</span></code> using the <code class="docutils literal notranslate"><span class="pre">r</span> <span class="pre">+</span> <span class="pre">1j</span> <span class="pre">*</span> <span class="pre">i</span></code> syntax to create complex numbers.</p>
<blockquote>
<div><p>Note that the time index is maintained for the resulting <code class="docutils literal notranslate"><span class="pre">pd.Series</span></code> and that the name allows us to easily identify the series as we continue processing our data.</p>
</div></blockquote>
<p>Complex numbers are represented by two floating point components, a real and imaginary component. The simplest way to visualize this data is to plot each component on their own axis. We will create a function <code class="docutils literal notranslate"><span class="pre">extract_real_imaginary</span></code> that decomposes the complex number into these component series. However, this takes up both our plotting dimensions, so we once again have to use color to visualize change over time:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_real_imaginary</span><span class="p">(</span><span class="n">phasor</span><span class="p">):</span>
    <span class="n">real</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">phasor</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;real&quot;</span><span class="p">)</span>
    <span class="n">imag</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">phasor</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;imaginary&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">real</span><span class="p">,</span> <span class="n">imag</span>


<span class="k">def</span> <span class="nf">plot_real_imaginary</span><span class="p">(</span><span class="n">phasor</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">()</span>

    <span class="n">real</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">extract_real_imaginary</span><span class="p">(</span><span class="n">phasor</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>

    <span class="n">cm</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;cividis_r&#39;</span><span class="p">)</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;real component&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;imaginary component&quot;</span><span class="p">)</span>

    <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>

<span class="n">_</span> <span class="o">=</span> <span class="n">plot_real_imaginary</span><span class="p">(</span><span class="n">phasor</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Complex Plot" src="../../_images/complex_plot.png" /></p>
<p>This plot is certainly very useful for visualizing single complex streams, e.g. a single phase. But what if we want to plot all three phases? In two dimensions, we couldn’t use color to differentiate each individual stream, so we’d have to use different marker shapes, but that may be difficult to visualize. Alternatively, we could plot each phase in its own axes and line them up, but again, that might be tough to compare phases. To solve this problem, we can use a 3D plot to plot the real and imaginary components as well as the time component each on their own axes, then use color to represent different phases or streams.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>

<span class="k">def</span> <span class="nf">plot_real_imaginary_3d</span><span class="p">(</span><span class="n">phasor</span><span class="p">):</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>

    <span class="n">real</span><span class="p">,</span> <span class="n">imag</span> <span class="o">=</span> <span class="n">extract_real_imaginary</span><span class="p">(</span><span class="n">phasor</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">real</span><span class="p">,</span> <span class="n">imag</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">phasor</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;real component&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s2">&quot;imaginary component&quot;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="n">times</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">([</span><span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">times</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">phasor</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">_</span> <span class="o">=</span> <span class="n">plot_real_imaginary_3d</span><span class="p">(</span><span class="n">phasor</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="3D Complex Plot" src="../../_images/3d_complex.png" /></p>
<p>Given enough time series data it may be possible to use 3D plots to visualize <span class="xref myst">voltage sags</span>, angle divergence, changes in impedance, changes in load and demand, variability due to oscillations, or other events on the electric grid that may be useful to detect using machine learning and AI methods.</p>
</section>
<section id="conclusion">
<h2>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h2>
<p>Although the phasor is the primary unit of measurement for electricity transmission and distribution, it poses a challenge to data scientists who may not be used to dealing with complex numbers in their modeling and analytical activities. In this post we explored several techniques for visualizing phasor data and demonstrated that even single phasors are multi-dimensional and require slightly more advanced visualization techniques.</p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="whats-in-a-phasor.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">What is a Phasor?</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="power-factor.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Power Factor Analysis</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, PingThings.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>