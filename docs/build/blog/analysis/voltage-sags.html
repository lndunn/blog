
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Voltage Sag Safari &#8212; NI4AI Blog 0.1 documentation</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet">
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/blank.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="shortcut icon" href="../../_static/tree.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Benchmarking Results" href="benchmarking-results.html" />
    <link rel="prev" title="Counting tap changer operations" href="tap-change.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    
      
      <link rel="icon" sizes="16x16" href="../../_static/_static/tree.png">
      
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../../index.html">
  <img src="../../_static/PingThings_logo_color.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../../quickstart/index.html">
  Quickstart
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../data/index.html">
  Data
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Learn
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../workshops/index.html">
  Watch
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../tutorials/index.html">
  Code
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://btrdb.readthedocs.io/en/latest/">API Docs<i class="fas fa-external-link-alt"></i></a>
    </li>
    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://www.pingthings.io/">PingThings<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/PingThingsIO/ni4ai-notebooks" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://www.pingthings.io/" rel="noopener" target="_blank" title="PingThings">
            <span><i class="fa"></i></span>
            <label class="sr-only">PingThings</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Access the PredictiveGrid
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://ni4ai.org">
   Register
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://plot.ni4ai.org">
   Plotter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://jupyter.ni4ai.org">
   Jupyterhub
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://ni4ai.org/datasets">
   Data
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Learn More
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="../index.html">
   Learn
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../platform/index.html">
     Platform
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
    <label for="toctree-checkbox-2">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/plotter-demo.html">
       Plotter Demo
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/api-demo.html">
       Demo: Connecting to the API
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/btrdb-explained.html">
       BTrDB Explained
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/btrdb-queries-pt1.html">
       Memory Efficient BTrDB Queries: Part 1
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/btrdb-queries-pt2.html">
       Memory Efficient BTrDB Queries: Part 2
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../platform/benchmarking-results.html">
       PredictiveGrid Benchmarks
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 current active has-children">
    <a class="reference internal" href="index.html">
     Analytics
    </a>
    <input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
    <label for="toctree-checkbox-3">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul class="current">
     <li class="toctree-l3">
      <a class="reference internal" href="quadrature-demodulation.html">
       Harmonic Phasor Estimation with Quadrature Demodulation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="spectral-analysis.html">
       Spectral Analysis (part 1)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="disaggregation.html">
       Solar Disaggregation
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="angle-differencing.html">
       Angle Differencing
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="tap-change.html">
       Counting tap changer operations
      </a>
     </li>
     <li class="toctree-l3 current active">
      <a class="current reference internal" href="#">
       Voltage Sag Safari
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="benchmarking-results.html">
       Benchmarking Results
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="symmetrical-components.html">
       Symmetrical Components
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="what-is-the-angle-1.html">
       What’s the Angle? (Part 1)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="what-is-the-angle-2.html">
       What’s the Angle? (Part 2)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="whats-in-a-phasor.html">
       What is a Phasor?
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="visualizing-phasor-timeseries.html">
       Visualizing Phasor Timeseries with matplotlib
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="power-factor.html">
       Power Factor Analysis
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="linear-models-overview.html">
       Training Linear Models
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="blue-cut-fire.html">
       Blue Cut Fire
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="btrdb-queries-pt1.html">
       Memory Efficient Queries (Part 1)
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="btrdb-queries-pt2.html">
       Memory Efficient Queries (Part 2)
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../commentary/index.html">
     Commentary
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../commentary/fire-season.html">
       Fire season is just around the corner
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../commentary/pmu-siting-2.html">
       Choosing where to site distribution PMUs
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../commentary/ekg-data.html">
       On EKG Data
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../ni4ai/index.html">
     Get Involved in NI4AI
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
    <label for="toctree-checkbox-5">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../ni4ai/add-sensors.html">
       Stream Data to NI4AI
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ni4ai/language-bindings-survey.html">
       Language Bindings
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ni4ai/democratizing-data.html">
       Democratizing Grid Data
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ni4ai/expertise-for-experts.html">
       Expertise for Experts
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../ni4ai/sunshine-data.html">
       A brief walkthrough of the Sunshine uPMU dataset
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../workshops/index.html">
   Watch
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshops/sascha.html">
     Understanding PMU Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshops/kevin.html">
     Use Cases and Applications for PMU Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshops/sean.html">
     The Power of Data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshops/mohini.html">
     Voltage Sag Detection
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../workshops/miles.html">
     Exploring Frequency and Phase
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tutorials/index.html">
   Code
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/quickstart.html">
     0 - PredictiveGrid in Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/collections.html">
     1 - Finding Collections &amp; Streams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/streams.html">
     2 - Working with Streams
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/streamsets.html">
     3 - Working with StreamSets
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/plots.html">
     4 - Basic Plots
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/statpoints.html">
     5: Working with StatPoints
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/queries.html">
     6 - Memory Efficient Queries
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/metadata.html">
     7 - Working with Metadata
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/windows.html">
     8 - Windows, aligned windows, and values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/plotaggregates.html">
     9 - Visualizing Aggregates
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tutorials/ingestion.html">
     10 - Data Ingestion
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://btrdb.readthedocs.io/en/latest/">
   API Docs
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  About Us
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference external" href="https://pingthings.io">
   PingThings
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://ni4ai.org/about">
   NI4AI
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference external" href="https://ni4ai.org/contact">
   Contact Us
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finding-voltage-sags">
   Finding Voltage Sags
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#counting-voltage-sags">
   Counting Voltage Sags
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#exploring-voltage-sags">
   Exploring Voltage Sags
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="voltage-sag-safari">
<h1>Voltage Sag Safari<a class="headerlink" href="#voltage-sag-safari" title="Permalink to this headline">¶</a>
</h1>
<blockquote>
<div>
<p><em>Author: Mohini Bariya</em></p>
<p>This blog post demonstrates the use of StatPoints to efficiently discover, count, and analyze voltage sags. Code accompanying this post can be found <a class="reference external" href="https://github.com/PingThingsIO/ni4ai-notebooks/blob/main/analytics/Voltage%20Sag%20Exploration.ipynb">here</a>.</p>
</div>
</blockquote>
<hr class="docutils">
<p><em>Voltage sags</em> are significant transient dips in the network voltage, lasting for less than a cycle to several seconds. They can be caused by faults, motor starts, equipment misoperation, or fast reclosing operation of circuit breakers and are relatively common events in distribution and transmission networks. Large, long, or frequent voltage sags can be problematic for utilities, as they can cause sensitive loads to turn off, motors to stall, or solar photovoltaic inverters to trip offline. Load trips can be a serious nuisance, with substantial economic losses particularly for commercial customers. Large numbers of simultaneous inverter trips could lead to broader system instability.</p>
<p>There are also safety implications, as a voltage sag may indicate a momentary fault that was not recognized and cleared by protection systems (also known as a high-impedance fault) — for example, momentary contact between distribution conductors and trees. Such faults can be precursors to even more dangerous conditions, such as wildfire ignition. Distribution PMU measurements, sampled at 120 Hz, give unprecedented visibility of voltage sags, capturing even the small, brief dips that would be invisible in most other measurements. BTrDB then allows us to easily find, extract, and analyze these sags from a large measurement stream to gain system insights.</p>
<p>In this post, we use the simple BTrDB search functions introduced <span class="xref myst">previously</span> to find voltage sags. We then use Python’s wonderful data visualization libraries to visually analyze and discover patterns in the sags and to share our findings. Along the way, we learn some interesting facts about voltage sags!</p>
<section id="finding-voltage-sags">
<h2>Finding Voltage Sags<a class="headerlink" href="#finding-voltage-sags" title="Permalink to this headline">¶</a>
</h2>
<p>To find voltage sags, we must recognize them. Large voltage sags are distinctly visible in BTrDB voltage measurements as sharp, long deviations from mostly flat voltage profiles:</p>
<p><img alt="Voltage sags are clearly visible in BTrDB" src="../../_images/btrdb_sags.png"></p>
<p>According to one definition, a voltage sag is “a decrease in the rms ac voltage between 0.1 and 0.9 p.u. at the power frequency for a duration of 0.5 cycles to 1 min” <a class="reference external" href="#references">[1]</a>. The magnitude and duration thresholds differ in other definitions. For flexibility, we will define a voltage sag as a drop in voltage below <span class="math notranslate nohighlight">\(\tau\)</span>, which will generally be some fraction of the nominal voltage, <span class="math notranslate nohighlight">\(V_{nom}\)</span>. The following function uses an efficient depth first search to find all voltage measurement points below <span class="math notranslate nohighlight">\(\tau\)</span>, which we term <em>sag points</em>. It is a slightly modified version of the DFS function introduced <span class="xref myst">previously</span>.</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">find_vsags_dfs</span><span class="p">(</span>
    <span class="n">stream</span><span class="p">,</span>
    <span class="n">tau</span><span class="p">,</span>
    <span class="n">start</span><span class="o">=</span><span class="n">btrdb</span><span class="o">.</span><span class="n">MINIMUM_TIME</span><span class="p">,</span>
    <span class="n">end</span><span class="o">=</span><span class="n">btrdb</span><span class="o">.</span><span class="n">MAXIMUM_TIME</span><span class="p">,</span>
    <span class="n">pw</span><span class="o">=</span><span class="mi">48</span><span class="p">,</span>
    <span class="n">version</span><span class="o">=</span><span class="mi">0</span>
<span class="p">):</span>
    <span class="c1"># Ensure pw is a pointwidth object</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="n">pointwidth</span><span class="p">(</span><span class="n">pw</span><span class="p">)</span>
    <span class="c1"># Begin by collecting all stat points at the specified pointwidth</span>
    <span class="c1"># Note that zip creates a list of windows and versions and we ignore the versions</span>
    <span class="n">windows</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">stream</span><span class="o">.</span><span class="n">aligned_windows</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">pw</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
    <span class="c1"># Traversing from left to right from the windows</span>
    <span class="k">for</span> <span class="n">window</span> <span class="ow">in</span> <span class="n">windows</span><span class="p">:</span>
        <span class="c1"># Check to see if the value is in the window</span>
        <span class="k">if</span> <span class="n">window</span><span class="o">.</span><span class="n">min</span> <span class="o">&lt;=</span> <span class="n">tau</span><span class="p">:</span>
            <span class="c1"># Get the time range of the current window</span>
            <span class="n">wstart</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">time</span>
            <span class="n">wend</span> <span class="o">=</span> <span class="n">window</span><span class="o">.</span><span class="n">time</span> <span class="o">+</span> <span class="n">pw</span><span class="o">.</span><span class="n">nanoseconds</span>
            <span class="c1"># If we are at a window length of a second, use values</span>
            <span class="k">if</span> <span class="n">pw</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span>
                <span class="n">points</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">stream</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="n">wstart</span><span class="p">,</span> <span class="n">wend</span><span class="p">,</span> <span class="n">version</span><span class="p">))</span>
            <span class="c1"># Otherwise, traverse the stat point children of this node</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">points</span> <span class="o">=</span> <span class="n">find_vsags_dfs</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">tau</span><span class="p">,</span> <span class="n">wstart</span><span class="p">,</span> <span class="n">wend</span><span class="p">,</span> <span class="n">pw</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">version</span><span class="p">)</span>
            <span class="c1"># Yield all points to the calling function</span>
            <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">points</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">point</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;=</span> <span class="n">tau</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">point</span>
</pre></div>
</div>
<p>The function <code class="docutils literal notranslate"><span class="pre">find_vsags_dfs</span></code> returns a <em>generator</em> which will output sag points when queried.  We can easily obtain the time series of a voltage sag by applying <code class="docutils literal notranslate"><span class="pre">find_vsags_dfs</span></code> to a stream over a short time period and then querying a window of raw measurements about the first sag point.</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="n">sags</span> <span class="o">=</span> <span class="n">find_vsags_dfs</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="c1"># Get the first sag point</span>
<span class="n">sag_point</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">sags</span><span class="p">)</span>
<span class="c1"># A utility function which queries a window of data around a point</span>
<span class="n">sag_data</span> <span class="o">=</span> <span class="n">get_event</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">sag_point</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="c1"># Plot the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">();</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sag_data</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sample Voltage Sag'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Time Index'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Voltage Magnitude'</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting voltage sag is shown below:</p>
<p><img alt="Example voltage sag" src="../../_images/example_sag.png"></p>
</section>
<section id="counting-voltage-sags">
<h2>Counting Voltage Sags<a class="headerlink" href="#counting-voltage-sags" title="Permalink to this headline">¶</a>
</h2>
<p>The generator returns every sag point, but several of these points will belong to a single voltage sag. We write another function, <code class="docutils literal notranslate"><span class="pre">sag_survey</span></code>, which processes the points returned by the generator to determine the starting time, the duration, and the minimum magnitude of every voltage sag in the time period of interest. We choose 1 s. to be the minimum separation between distinct voltage sags.</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sag_survey</span><span class="p">(</span><span class="n">sags</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1"># Initialize sag information</span>
    <span class="n">starts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">durations</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">magnitudes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># Get the first sag</span>
    <span class="n">sag</span> <span class="o">=</span> <span class="n">safe_next</span><span class="p">(</span><span class="n">sags</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">sag</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">"No voltage sags found."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Voltage sag found!"</span><span class="p">)</span>
        <span class="n">start</span><span class="p">,</span> <span class="n">mag</span> <span class="o">=</span> <span class="n">sag</span>
        <span class="n">dur</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="n">sag</span><span class="p">:</span>
        <span class="n">sag</span> <span class="o">=</span> <span class="n">safe_next</span><span class="p">(</span><span class="n">sags</span><span class="p">)</span>
        <span class="c1"># If we are on the last sag</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">sag</span> <span class="o">==</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">count</span> <span class="o">&gt;</span> <span class="n">limit</span><span class="p">):</span>
            <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
            <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dur</span><span class="p">)</span>
            <span class="n">magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
            <span class="n">sag</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sag_time</span><span class="p">,</span> <span class="n">sag_value</span> <span class="o">=</span> <span class="n">sag</span>
            <span class="c1"># Check if this is a different sag</span>
            <span class="c1"># More than 1 s after last sag point</span>
            <span class="k">if</span> <span class="n">sag_time</span> <span class="o">-</span> <span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">dur</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mf">1e9</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Voltage sag found!"</span><span class="p">)</span>
                <span class="c1"># Save last sag</span>
                <span class="n">starts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start</span><span class="p">)</span>
                <span class="n">durations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dur</span><span class="p">)</span>
                <span class="n">magnitudes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mag</span><span class="p">)</span>
                <span class="c1"># Increment sag count</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Initialize next sag</span>
                <span class="n">start</span> <span class="o">=</span> <span class="n">sag_time</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="n">sag_value</span>
                <span class="n">dur</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># Otherwise update properties of this sag</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">dur</span> <span class="o">=</span> <span class="n">sag_time</span> <span class="o">-</span> <span class="n">start</span>
                <span class="n">mag</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">mag</span><span class="p">,</span> <span class="n">sag_value</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">starts</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">magnitudes</span><span class="p">)</span>
<span class="c1"># A convenience for iterating through a generator</span>
<span class="k">def</span> <span class="nf">safe_next</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">first</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">iterable</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">first</span>
</pre></div>
</div>
<p>Notice the <code class="docutils literal notranslate"><span class="pre">safe_next</span></code> helper function through which we query the sag point generator. The generator will throw a <code class="docutils literal notranslate"><span class="pre">StopIteration</span></code> exception after returning the last sag point. Since we don’t know the number of sag points apriori, <code class="docutils literal notranslate"><span class="pre">safe_next</span></code> enables us to properly handle the end of the generator and avoid an exception.</p>
<p>We run <code class="docutils literal notranslate"><span class="pre">sag_survey</span></code> on one month of PMU measurements, choosing a sag threshold of <span class="math notranslate nohighlight">\(\tau = 0.99V_{nom}\)</span>:</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="c1"># Choose the stream</span>
<span class="n">stream</span> <span class="o">=</span> <span class="n">streams</span><span class="p">[</span><span class="s2">"35bdb8dc-bf18-4523-85ca-8ebe384bd9b5"</span><span class="p">]</span>
<span class="c1"># Get nominal voltage of stream</span>
<span class="n">vnom</span> <span class="o">=</span> <span class="n">get_mean_value</span><span class="p">(</span><span class="n">stream</span><span class="p">)</span>
<span class="c1"># Start and end times of period to study</span>
<span class="n">start</span> <span class="o">=</span> <span class="s2">"2016-11-20T00:00:00.000Z"</span>
<span class="n">end</span> <span class="o">=</span> <span class="s2">"2016-12-20T00:00:00.000Z"</span>
<span class="c1"># Threshold below which data is considered a voltage sag</span>
<span class="n">thresh</span> <span class="o">=</span> <span class="mf">0.99</span> <span class="o">*</span> <span class="n">vnom</span>
<span class="c1"># Find voltage sag data points</span>
<span class="n">sags</span> <span class="o">=</span> <span class="n">find_vsags_dfs</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="c1"># Get features of voltage sags</span>
<span class="n">starts</span><span class="p">,</span> <span class="n">durs</span><span class="p">,</span> <span class="n">mags</span> <span class="o">=</span> <span class="n">sag_survey</span><span class="p">(</span><span class="n">sags</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Print magnitudes of sags</span>
<span class="nb">print</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
<p>The search is over more than a 150 <em>million</em> points, and runs in 12 <em>seconds</em>! It finds seven sags with the following minimium magnitudes:</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="p">[</span><span class="mf">6769.92675781</span> <span class="mf">6753.34423828</span> <span class="mf">6851.39550781</span> <span class="mf">6591.23486328</span> <span class="mf">6911.60888672</span>
 <span class="mf">6875.84033203</span> <span class="mf">6891.41845703</span><span class="p">]</span>
</pre></div>
</div>
</section>
<section id="exploring-voltage-sags">
<h2>Exploring Voltage Sags<a class="headerlink" href="#exploring-voltage-sags" title="Permalink to this headline">¶</a>
</h2>
<p>Now we are ready to do some exploration. The most basic features of voltage sags are their size and duration. The combination of these features determines the extent of their detrimental impact on sensitive loads <a class="reference external" href="#references">[2]</a>. To understand the size and duration of voltage sags at one location, we use <code class="docutils literal notranslate"><span class="pre">sag_survey</span></code> to search for voltage sags across <em>three months</em> of measurements. We create a scatter plot showing the size and duration of each sag.</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="c1"># Find voltage sag data points</span>
<span class="n">sags</span> <span class="o">=</span> <span class="n">find_vsags_dfs</span><span class="p">(</span><span class="n">stream</span><span class="p">,</span> <span class="n">thresh</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">end</span><span class="p">)</span>
<span class="c1"># Get features of voltage sags</span>
<span class="n">starts</span><span class="p">,</span> <span class="n">durs</span><span class="p">,</span> <span class="n">mags</span> <span class="o">=</span> <span class="n">sag_survey</span><span class="p">(</span><span class="n">sags</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">durs</span> <span class="o">/</span> <span class="mf">1e9</span><span class="p">,</span> <span class="n">mags</span> <span class="o">/</span> <span class="n">vnom</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Size vs. Duration of Voltage Sags'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Durations (s.)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Minimum magnitude (V)'</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Magnitude and duration of sags over 3 months" src="../../_images/size_vs_durs.png"></p>
<p>Smaller, shorter sags form the cluster in the top left corner and are the most frequent. We see that this location doesn’t have any large long sags, which would show up as points in the bottom right and be the most problematic.</p>
<p>An interesting result in the literature says that the normalized frequency of sags with magnitude <span class="math notranslate nohighlight">\(V\)</span> will be proportional to <span class="math notranslate nohighlight">\(\frac{V}{1-V}\)</span>. This formula emerges from a highly simplified model of fault induced sags <a class="reference external" href="#references">[3]</a>. To see how well it applies to our empirical data, we transform our scatter plot into a histogram and overlay the appropriately scaled <span class="math notranslate nohighlight">\(\frac{V}{1-V}\)</span> curve.</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="c1"># Plot a histogram of the sag magnitudes</span>
<span class="n">pmags</span> <span class="o">=</span> <span class="n">mags</span> <span class="o">/</span> <span class="n">vnom</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">pmags</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># Plot normalized V / (1-V)</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">freq_vs_size</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">'$\frac</span><span class="si">{V}</span><span class="s1">{1-V}$'</span><span class="p">)</span>

<span class="c1"># Add keys</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Frequency vs Magnitude of Voltage Sags'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Magnitude'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Normalized Frequency'</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="Sag frequency as a function of magnitude" src="../../_images/freq_vs_voltage.png"></p>
<p>The fit is pretty good!</p>
<p>An open question in the literature is the impact of distributed generation (DG) on the size and frequency of voltage sags. There is hesitant speculation that DG may mitigate the impacts of sags by supporting the local voltage during a sag <a class="reference external" href="#references">[4]</a>. We can study this question on a dataset of 4 PMU measurements from a system with a PV installation. The measurements are at a common voltage level, but are not all on the same feeder. PMU 1 measures at the coupling point of a large PV array, PMU 3 is at the substation above the PV site, while PMUs 4 and 5 are at a substation some distance away.</p>
<p><img alt="DG impacts on voltage sag" src="../../_images/sag_comparison.png"></p>
<p>In the scatter plot, points indicate individual voltage sags, while stars show the average sag magnitude and duration at each PMU. We see that PMU 1, directly at the PV site, has the smallest average sag magnitude. PMU 3, at the substation above the PV site, experiences larger average sags than PMU 1, but still smaller than PMUs 4 or 5. This cursory analysis suggests that the presence of DG may indeed reduce the size of voltage sags, though of course there are a plethora of other factors they may be behind the observed differences.</p>
<p>Voltage sag frequencies can show strong temporal dependences, such as seasonal or weekly patterns <a class="reference external" href="#references">[5]</a>. This reflects the temporal patterns of the underlying causes of the sags. For example, sags due to vegetation contact faults may mostly occur during windy times of year, while sags caused by the operation of certain industrial equipment may occur only on weekdays. We explore any weekly patterns in the voltage sags at PMUs 4 and 5 with the following script:</p>
<div class="highlight-python notranslate">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">btrdb.utils.timez</span> <span class="kn">import</span> <span class="n">ns_to_datetime</span>
<span class="k">def</span> <span class="nf">get_day_counts</span><span class="p">(</span><span class="n">times</span><span class="p">):</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">time</span> <span class="ow">in</span> <span class="n">times</span><span class="p">:</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">ns_to_datetime</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">day</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">weekday</span><span class="p">())</span>
        <span class="n">counts</span><span class="p">[</span><span class="n">day</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">counts</span>

<span class="n">daysofweek</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'M'</span><span class="p">,</span> <span class="s1">'Tu'</span><span class="p">,</span> <span class="s1">'W'</span><span class="p">,</span> <span class="s1">'Th'</span><span class="p">,</span> <span class="s1">'F'</span><span class="p">,</span> <span class="s1">'Sa'</span><span class="p">,</span> <span class="s1">'Su'</span><span class="p">]</span>
<span class="n">counts1</span> <span class="o">=</span> <span class="n">get_day_counts</span><span class="p">(</span><span class="n">starts1</span><span class="p">)</span>
<span class="n">counts2</span> <span class="o">=</span> <span class="n">get_day_counts</span><span class="p">(</span><span class="n">starts2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">daysofweek</span><span class="p">,</span> <span class="n">counts1</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sags at PMU 4'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Count'</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">daysofweek</span><span class="p">,</span> <span class="n">counts2</span><span class="p">,</span> <span class="n">align</span><span class="o">=</span><span class="s1">'center'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'Sags at PMU 5'</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice in this script we use the <code class="docutils literal notranslate"><span class="pre">ns_to_datetime</span></code> function from <code class="docutils literal notranslate"><span class="pre">btrdb.utils.timez</span></code>. BTrDB deals in nanoseconds and returns timestamps as <em>nanoseconds since the epoch</em>. <code class="docutils literal notranslate"><span class="pre">btrdb.utils.timez</span></code>, documented <a class="reference external" href="https://btrdb.readthedocs.io/en/latest/api/utils-timez.html">here</a>, contains helpful functions to convert between these nanosecond timestamps and more human-friendly ones. The <code class="docutils literal notranslate"><span class="pre">ns_to_datetime</span></code> function returns a Python <code class="docutils literal notranslate"><span class="pre">datetime</span></code> object with many useful properties, which you can explore <a class="reference external" href="https://docs.python.org/3/library/datetime.html">here</a>.</p>
<p>After running this script on several months of data with <span class="math notranslate nohighlight">\(\tau = 0.98V_{nom}\)</span>, we obtain the following bar plots.</p>
<p><img alt="sag frequency by day of week" src="../../_images/sags_by_day.png"></p>
<p>Note that our choice of <span class="math notranslate nohighlight">\(\tau\)</span> is high, so many of these sags will be small. Yet certain days dominate in the occurrence of sags. Other explorations would be necessary to determine why this is so.</p>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a>
</h2>
<p>[1] Milanovic, J. V., Aung, M. T., &amp; Gupta, C. P. (2005). The influence of fault distribution on stochastic prediction of voltage sags. IEEE Transactions on Power Delivery, 20(1), 278-285.</p>
<p>[2] Shen, C. C., &amp; Lu, C. N. (2007). A voltage sag index considering compatibility between equipment and supply. IEEE Transactions on Power Delivery, 22(2), 996-1002.</p>
<p>[3] Bollen, M. H. (1996). Voltage sags: effects, mitigation and prediction. Power Engineering Journal, 10(3), 129-135.</p>
<p>[4] McDermott, T. E., &amp; Dugan, R. C. (2002, May). Distributed generation impact on reliability and power quality indices. In 2002 Rural Electric Power Conference. Papers Presented at the 46th Annual Conference (Cat. No. 02CH37360) (pp. D3-1). IEEE.</p>
<p>[5]Herath, H. C., &amp; McHardy, S. (2008, October). Power quality trends in energy Australia distribution network. In 2008 13th International Conference on Harmonics and Quality of Power (pp. 1-6). IEEE.</p>
</section>
</section>



              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="tap-change.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Counting tap changer operations</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="benchmarking-results.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Benchmarking Results</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, PingThings.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>